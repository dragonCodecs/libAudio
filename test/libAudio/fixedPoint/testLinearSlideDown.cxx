#include "slideTestCommon.hxx"

/* The following function generates this */
const uint16_t linearSlideDownTable[256] =
{
	65535, 65299, 65064, 64830, 64596, 64363, 64131, 63900,
	63670, 63440, 63212, 62984, 62757, 62531, 62305, 62081,
	61857, 61634, 61412, 61191, 60970, 60751, 60532, 60314,
	60096, 59880, 59664, 59449, 59235, 59021, 58809, 58597,
	58385, 58175, 57965, 57757, 57548, 57341, 57134, 56928,
	56723, 56519, 56315, 56112, 55910, 55709, 55508, 55308,
	55108, 54910, 54712, 54515, 54318, 54123, 53928, 53733,
	53540, 53347, 53154, 52963, 52772, 52582, 52392, 52204,
	52015, 51828, 51641, 51455, 51270, 51085, 50901, 50717,
	50535, 50353, 50171, 49990, 49810, 49631, 49452, 49274,
	49096, 48919, 48743, 48567, 48392, 48218, 48044, 47871,
	47698, 47526, 47355, 47185, 47014, 46845, 46676, 46508,
	46340, 46173, 46007, 45841, 45676, 45511, 45347, 45184,
	45021, 44859, 44697, 44536, 44376, 44216, 44056, 43898,
	43740, 43582, 43425, 43268, 43112, 42957, 42802, 42648,
	42494, 42341, 42189, 42037, 41885, 41734, 41584, 41434,
	41285, 41136, 40988, 40840, 40693, 40546, 40400, 40254,
	40109, 39965, 39821, 39677, 39534, 39392, 39250, 39108,
	38967, 38827, 38687, 38548, 38409, 38270, 38132, 37995,
	37858, 37722, 37586, 37450, 37315, 37181, 37047, 36913,
	36780, 36648, 36516, 36384, 36253, 36122, 35992, 35862,
	35733, 35604, 35476, 35348, 35221, 35094, 34968, 34842,
	34716, 34591, 34466, 34342, 34218, 34095, 33972, 33850,
	33728, 33606, 33485, 33364, 33244, 33124, 33005, 32886,
	32768, 32649, 32532, 32415, 32298, 32181, 32065, 31950,
	31835, 31720, 31606, 31492, 31378, 31265, 31152, 31040,
	30928, 30817, 30706, 30595, 30485, 30375, 30266, 30157,
	30048, 29940, 29832, 29724, 29617, 29510, 29404, 29298,
	29192, 29087, 28982, 28878, 28774, 28670, 28567, 28464,
	28361, 28259, 28157, 28056, 27955, 27854, 27754, 27654,
	27554, 27455, 27356, 27257, 27159, 27061, 26964, 26866,
	26770, 26673, 26577, 26481, 26386, 26291, 26196, 26102
};

class linearSlideDown_t final : public testsuit
{
private:
	uint32_t linearSlideDown(uint8_t slide) const noexcept
	{
		constexpr fixed64_t c192{192};
		constexpr fixed64_t c65535{65535};
		const fixed64_t result = (fixed64_t{slide, 0, -1} / c192).pow2() * c65535;
		return int{result};
	}

	void testComputation()
	{
		for (size_t i{0}; i < 256; ++i)
		{
			const uint32_t slide = linearSlideDown(i);
			if (slide != linearSlideDownTable[i])
			{
				if (unsign(linearSlideDownTable[i] - slide) < 2)
					displayWarning(slide, linearSlideDownTable[i]);
				else
					assertEqual(slide, linearSlideDownTable[i]);
			}
		}
		displayWarningCount();
	}

public:
	void registerTests() final override
	{
		CXX_TEST(testComputation)
	}
};

CRUNCHpp_TEST void registerCXXTests();
void registerCXXTests()
	{ registerTestClasses<linearSlideDown_t>(); }